<div class="content">
    <div class="top-bar">
        <button type="button" class="btn btn-primary" (click)="onGoBack()">
            Retour à la liste
        </button>
        <div class="item">
            <form name="" action="#" method="GET">
                <input type="text" name="filter" placeholder="Filtrer">
                <select>
                    <option>Par Catégorie</option>
                    <option>Par Auteur</option>
                    <option>Par Année de sortie</option>
                    <option>Par Editeur</option>
                </select>
            </form>
        </div>
    </div>
    <p class="badge-label">Recherche: <b>{{query.request|uppercase}}</b> -
        {{(query.totalItems)?query.totalItems:"aucun"}}
        éléments trouvés</p>

    <div class="card" *ngFor="let book of books ; let i = index">
        <img src="{{book.imageLink}}" alt="book">
        <div class="card-body">
            <b>{{(book.title.length>30)?(book.title|slice:0:30)+'...':book.title}}</b><br>
            <div *ngIf="book.authors; else elseAuthor">
                <div class="small"><b>Auteurs</b>:
                    <div *ngFor="let a of book.authors; let i = index;"><span *ngIf="i <3" class="small">{{a}}</span>
                    </div><br>
                </div>
            </div>
            <ng-template #elseAuthor>
                <span class="small">Auteurs: inconus</span><br>
            </ng-template>

            <div *ngIf="book.price > 0; else elsePrice">
                <h4 class="small"><b>{{book.price}} {{book.currency}}</b></h4><br>
            </div>
            <ng-template #elsePrice>
                <span>Prix: inconnu</span>
            </ng-template>

            <div class="small">

                <b>Catégorie:</b>
                <div *ngIf="book.categories; else elseCat">
                    <div *ngFor="let c of book.categories;">
                        {{c}}
                    </div>
                </div>
                <ng-template #elseCat>
                    <h5>Catégotie: inconnu</h5>
                </ng-template>
            </div>

            <span class="badge">Langue: {{book.language}}</span>
            <span class="badge">Publié: {{book.publishedDate|date: 'yyyy'}}</span>
            <span class="badge">eBook: {{book.isEbook?'Yes':'No'}}</span>

        </div>
        <div class="card-footer">
            <div class="popup">
                <button type="button" class="btn btn-primary" (click)="openPopup(i)">+Détails</button>
                <div class="popup-warp" id="popup{{i}}">
                    <div class="popup-content">
                        <p class="description">
                            <b>{{book.title}}</b><br>
                            <b>Description</b>
                            {{(book.description|slice:0:1000)+'...'}}
                        </p>

                        <div class="popup-footer">
                            <a href="{{book.link}}" target="_blank" class="badge-colored">go to Google Book</a>
                            <span class="badge">{{book.pageCount}} pages</span>
                            <span class="badge">Publié par: {{book.publisher}}</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

</div>
